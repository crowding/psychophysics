function result=targetmodedisplay(el)% USAGE: result=targetmodedisplay(el)%%		el: eyelink default values% History% 15-05-01	fwc created first version% 22-05-01	fwc	little debugging% 02-06-01	fwc removed use of global el, as suggested by John Palmer.result=-1; % initializeif nargin < 1	error( 'USAGE: result=targetmodedisplay(el)' );endtargetvisible = 0;	% target currently drawntargetrect=[0 0 0 0];tx=el.MISSING;ty=el.MISSING;otx=el.MISSING;    % current target positionoty=el.MISSING;clearcaldisplay(el);	% setup_cal_display()key=1;while key~= 0	key=getkeyforeyelink(el);		% dump old keysend				% LOOP WHILE WE ARE DISPLAYING TARGETStickcount=0;				stop=0;while stop==0 & bitand(EYELINK( 'currentmode'), el.IN_TARGET_MODE)	if ~EYELINK( 'isconnected' )		result=-1;		return;	end;	[key, tickcount]=getkeyforeyelink(el, tickcount);		% getkey() HANDLE LOCAL KEY PRESS	switch key 		case el.TERMINATE_KEY,       % breakout key code			clearcaldisplay(el); % clear_cal_display();			result=el.TERMINATE_KEY;			return;		case el.SPACE_BAR,	         		% 32: accept fixation			if el.allowlocaltrigger==1				EYELINK( 'accepttrigger');			end			break;		case { 0,  el.JUNK_KEY	}	% No key		case el.ESC_KEY,			if EYELINK('isconnected') == el.dummyconnected				stop=1;			end		    if el.allowlocalcontrol==1 	       		EYELINK('sendkeybutton', key, 0, el.KB_PRESS );			end		otherwise,          % Echo to tracker for remote control		    if el.allowlocalcontrol==1 	       		EYELINK('sendkeybutton', key, 0, el.KB_PRESS );			end	end % switch key				% HANDLE TARGET CHANGES	[result, tx, ty]= EYELINK( 'targetcheck');	% erased or moved: erase target	if (targetvisible==1 & result==0) | tx~=otx | ty~=oty		erasecaltarget(el, targetrect);		targetvisible = 0;	end	% redraw if invisible	if targetvisible==0 & result==1		targetrect=drawcaltarget(el, tx, ty);		targetvisible = 1;		otx = tx;		% record position for future tests		oty = ty;		if el.targetbeep==1			caltargetbeep(el);	% optional beep to alert subject		end	end	end % while IN_TARGET_MODE% exit:					% CLEAN UP ON EXITif el.targetbeep==1	if EYELINK('calresult')==1  % does 1 signal success?		caldonebeep(el, 1);	else	  	caldonebeep(el, -1);	endend  if targetvisible	erasecaltarget(el, targetrect);   % erase target on exit, bit superfluous actuallyendclearcaldisplay(el); % clear_cal_display();result=0;return;